#ifndef FPGA_SIMULATOR_H_
#define FPGA_SIMULATOR_H_


#include <ap_fixed.h>
#include <ap_int.h>
#include <hls_stream.h>
#include <chrono>
#include <iostream>
#include <iomanip>
#include <math.h>
using namespace std;

//#include "hls_math.h"


//#include <ap_cint.h>
// configurable params
#define W_SOG 13
#define IW_SOG 7
#define W_COG 15
#define IW_COG 10
#define W_PHASE 32
#define IW_PHASE 9
#define W_SIN_COS   32
#define IW_SIN_COS   5
// Je suis obligé de donner la même longueur à pi qu'à phase car je réalise une division entre ces deux nombres.
#define W_PI 16
#define IW_PI 3
#define W_ENERGY 32
#define IW_ENERGY 6
#define W_STAT 32
#define IW_STAT 4
#define W_IN_FFT 24
#define IW_IN_FFT 14 // 12(PUISSANCE_2) +1
#define W_PHASE_SHIFT 32
#define IW_PHASE_SHIFT 15
#define W_TMP_MAX 16
#define IW_TMP_MAX 6
#define W_THRESHOLD 4
#define IW_THRESHOLD 3
#define W_LONGITUDE 32
#define IW_LONGITUDE 22
#define W_LONGITUDE_TMP_0 32
#define IW_LONGITUDE_TMP_0 28
#define W_LATITUDE 32
#define IW_LATITUDE 22
#define W_LATITUDE_TMP_0 32
#define IW_LATITUDE_TMP_0 27
#define W_LONGITUDE_RAD 32
#define IW_LONGITUDE_RAD 9
#define W_LATITUDE_RAD 32
#define IW_LATITUDE_RAD 8
#define W_LATITUDE_TMP 32
#define IW_LATITUDE_TMP 15
#define W_LONGITUDE_TMP 32
#define IW_LONGITUDE_TMP 15
#define W_DISTANCE 32
#define IW_DISTANCE 26
#define W_SNR 32
#define IW_SNR 24
#define W_SNR_1 32
#define IW_SNR_1 18
#define W_DAC   16
#define IW_DAC   0
#define W_TIME 32
#define IW_TIME 20
#define W_CHANGE_DYN 32
#define IW_CHANGE_DYN 22

typedef ap_fixed<W_SOG,IW_SOG> sog_f_t;
typedef ap_fixed<W_PHASE,IW_PHASE> phase_t;
//typedef ap_fixed<W_CORR,IW_CORR> corr_t;
typedef ap_fixed<W_SIN_COS,IW_SIN_COS> sin_cos_t;
typedef ap_ufixed<W_SIN_COS,IW_SIN_COS> sin_cos_u_t;
typedef ap_ufixed<W_PI,IW_PI> two_pi_t;
typedef ap_ufixed<W_ENERGY,IW_ENERGY> energy_t;
typedef ap_fixed<W_IN_FFT,IW_IN_FFT> IN_FFT_t;
typedef ap_fixed<W_PHASE_SHIFT,IW_PHASE_SHIFT> phase_shift_t;
typedef ap_ufixed<W_TMP_MAX,IW_TMP_MAX> tmp_max_t;
typedef ap_ufixed<W_THRESHOLD,IW_THRESHOLD> threshold_t;
typedef ap_fixed<W_LATITUDE,IW_LATITUDE> latitude_t;
typedef ap_fixed<W_LONGITUDE,IW_LONGITUDE> longitude_t;
typedef ap_fixed<W_LATITUDE_TMP_0,IW_LATITUDE_TMP_0> latitude_tmp_0_t;
typedef ap_fixed<W_LONGITUDE_TMP_0,IW_LONGITUDE_TMP_0> longitude_tmp_0_t;
typedef ap_fixed<W_LATITUDE_TMP,IW_LATITUDE_TMP> latitude_tmp_t;
typedef ap_fixed<W_LONGITUDE_TMP,IW_LONGITUDE_TMP> longitude_tmp_t;
typedef ap_fixed<W_LATITUDE_RAD,IW_LATITUDE_RAD> latitude_rad_t;
typedef ap_fixed<W_LONGITUDE_RAD,IW_LONGITUDE_RAD> longitude_rad_t;
typedef ap_ufixed<W_DISTANCE,IW_DISTANCE> distance_t;
typedef ap_ufixed<W_SNR,IW_SNR> snr_t;
typedef ap_ufixed<W_SNR_1,IW_SNR_1> snr_t1;
typedef ap_fixed<W_DAC,IW_DAC> dac_t;
typedef ap_fixed<W_STAT,IW_STAT> stat_t;
typedef ap_fixed<W_COG,IW_COG> cog_t;
typedef ap_fixed<W_SOG,IW_SOG> sog_t;
typedef ap_ufixed<W_TIME,IW_TIME> time1_t;
typedef ap_ufixed<W_CHANGE_DYN,IW_CHANGE_DYN> change_dyn_t;

//Nombre d'inforations transmises
#define NB_INFORMATION 16
//Nombre de message traité
#define NB_MESSAGE 1200
#define NB_BITS_DATA 168
#define NB_BITS_CRC 16
#define NB_BITS_DATA_CRC 184
#define FE 192000
#define F 9600
// FE/F
#define NB_SAMPLES_ECH 20
// 256*NB_SAMPLES_ECH
#define NB_EL_ARRAY 5120
//232=s168+5(stuffing)+16+3(stuffing)+24+8+8
#define NB_BITS_TRAME 232
//NB_BITS_TRAME*20 + 30
#define NB_EL_TRAME 4670
//nombre de bits max trame
#define NB_BITS_TRAME_MAX 256
//Le nombre d'échantillons de retard ne peut être au maximum de 450 ce qui correspond à 2.3ms
#define DELAY_NB_EL 0
//168/8
#define NB_BYTES_DATA 21
//184/8
#define NB_BYTES_DATA_CRC 23
// taille du tableau contenant les valeurs du cosinus et sinus
#define DATA_SIZE 256
//(256/2pi)Définition de la constante qui permettra de calculer la valeur des sinus et cosinus en utilisant une lookup table. c=256/(2pi)
#define CONST_ANGLE 40.7437
//(256/360) même raison que pour const_angle sauf que nous utilisons des degrés cette fois.
#define CONST_ANGLE_DEG 0.71111
#define TWO_PI 6.2832
//#define LEN_DIFF_PHASE_COND 501
#define LEN_DIFF_PHASE_COND 256
#define LEN_DIFF_PHASE_COND1 200
#define LEN_DIFF_PHASE_COND2 480
#define LEN_HANNING 50
// 2*pi/192000
#define ANGLE_FREQ 0.000032725
//le déplassement en fréqeunce correspond à la fréquence : f=SHIFT_FREQ*FE/NB_EL_ARRAY
#define SHIFT_FREQ 100
// CONST_ANGLE_SHIFT_ECH=2*pi/NB_EL_ARRAY
#define CONST_ANGLE_SHIFT_ECH 0.001227
//nombre d'échantillons sur lesquels seront appliqués la fft
#define NB_SAMPLES 8192 // nombre de données prises en entrée par la fft
#define NB_SAMPLES_TWO_POW_10 1024
#define PUISSANCE_2 13 // log_2(NB_SAMPLES)
//#define TWO_PI 6.28319 // valeur de 2pi la plus précise pour des variables de type phase_t
// position du recepteur AIS ce qui correspond à la position de m'émulateur AIS. Position exprimée en degré et en radian
#define LATITUDE_RE_RAD 0.570657
#define LONGITUDE_RE_RAD -1.692964
#define LATITUDE_RE_DEG 32.8051
#define LONGITUDE_RE_DEG -96.9997
//Rayon équatorial et polaire exprimé en km
#define RADIUS_EQ 6378000
#define RADIUS_PO 6357000
//SNR is the rate between the power. max value is 30db wich correpond to snr=1000
#define SNR 20
#define LEN_GAUSSIAN 61
//(256/360)
#define PI 3.1415926
//1.852*1000*180/(Rayon*3600*pi)
#define SOG_CONST 0.000004626510039337470

//Mise en place de l'équation de Friis. Valeur prise dans l'article sur la détection arrêt on/off
#define Pt 12.5;
//sqrt(Pt/2) le cosinus et le sinus ont une puissance de signal de 0.5. Et nous prenons la racine carré pour avoir affaire un la valeur absolue.
#define A_AMPLI 3.5;
#define Gt 1.58;
#define Gr 1.58;
//c/(f1) avec c en km/s et f1 en Hz ici 162.025MHz
#define LAMBDA 0.0019;
//sqrt(2*(Pt_a*Gt_a*Gr_a*(lambda1/(4*pi))^2)) car A^2/2=P avec A amplitude et P puissance.
// La constante de l'amplitude est homogène à des metres.
#define CONST_AMPL 1.168

#define POLYNOMIAL		0x8005
#define INITIAL_VALUE     0xFFFF
#define FINAL_XOR_VALUE		0xFFFF
#define REVERSED_DATA     TRUE
#define REVERSED_OUT  FALSE
#define WIDTH    168

//we fixe the dynamic data of the emitter before its starting
#define sog_value_e 200
//#define latitude_value_e 32.558
//#define latitude_value_e_int 19534800
#define latitude_value_e 32.8051
#define latitude_value_e_int 19683060
//#define longitude_value_e -97.2597
//#define longitude_value_e_int -58355820
#define longitude_value_e -96.9997
#define longitude_value_e_int -58200000
#define cog_value_e 350

//NB_TS=nb_minutes*2250 nombre de TS de simulation
#define NB_TS 2250
#define TIME_TS 0.0266

//Les données contiennent 168 bits seulement, en prenant en considération le bit stuffing, nous estimons et cela est confirmé par la norme que au pir 5 bits peuvent être rajoutés
typedef ap_uint<NB_BITS_DATA+10> data_t;
//Le crc contient 16 bits mais avec le bit stuffing il peut passer à 19bits
typedef ap_uint<NB_BITS_DATA+3> crc_t;
typedef ap_uint<8> start_end_flag_t;
typedef ap_uint<24> training_sequence_t;

const int pow_c[31]={0,0b1,0b11,0b111,0b1111,0b11111,0b111111,0b1111111,0b11111111,0b111111111,0b1111111111,0b11111111111,0b111111111111,0b1111111111111,0b11111111111111,0b111111111111111,0b1111111111111111,0b11111111111111111,0b111111111111111111,0b1111111111111111111,0b11111111111111111111,0b111111111111111111111,0b1111111111111111111111,0b11111111111111111111111,0b111111111111111111111111,0b1111111111111111111111111,0b11111111111111111111111111,0b111111111111111111111111111,0b1111111111111111111111111111,0b11111111111111111111111111111,0b111111111111111111111111111111};
const ap_uint<16> crctab16[256] ={0x0000, 0x1189, 0x2312, 0x329b, 0x4624, 0x57ad, 0x6536, 0x74bf,0x8c48, 0x9dc1, 0xaf5a, 0xbed3, 0xca6c, 0xdbe5, 0xe97e, 0xf8f7,0x1081, 0x0108, 0x3393, 0x221a, 0x56a5, 0x472c, 0x75b7, 0x643e,0x9cc9, 0x8d40, 0xbfdb, 0xae52, 0xdaed, 0xcb64, 0xf9ff, 0xe876,0x2102, 0x308b, 0x0210, 0x1399, 0x6726, 0x76af, 0x4434, 0x55bd,0xad4a, 0xbcc3, 0x8e58, 0x9fd1, 0xeb6e, 0xfae7, 0xc87c, 0xd9f5,0x3183, 0x200a, 0x1291, 0x0318, 0x77a7, 0x662e, 0x54b5, 0x453c,0xbdcb, 0xac42, 0x9ed9, 0x8f50, 0xfbef, 0xea66, 0xd8fd, 0xc974,0x4204, 0x538d, 0x6116, 0x709f, 0x0420, 0x15a9, 0x2732, 0x36bb,0xce4c, 0xdfc5, 0xed5e, 0xfcd7, 0x8868, 0x99e1, 0xab7a, 0xbaf3,0x5285, 0x430c, 0x7197, 0x601e, 0x14a1, 0x0528, 0x37b3, 0x263a,0xdecd, 0xcf44, 0xfddf, 0xec56, 0x98e9, 0x8960, 0xbbfb, 0xaa72,0x6306, 0x728f, 0x4014, 0x519d, 0x2522, 0x34ab, 0x0630, 0x17b9,0xef4e, 0xfec7, 0xcc5c, 0xddd5, 0xa96a, 0xb8e3, 0x8a78, 0x9bf1,0x7387, 0x620e, 0x5095, 0x411c, 0x35a3, 0x242a, 0x16b1, 0x0738,0xffcf, 0xee46, 0xdcdd, 0xcd54, 0xb9eb, 0xa862, 0x9af9, 0x8b70,0x8408, 0x9581, 0xa71a, 0xb693, 0xc22c, 0xd3a5, 0xe13e, 0xf0b7,0x0840, 0x19c9, 0x2b52, 0x3adb, 0x4e64, 0x5fed, 0x6d76, 0x7cff,0x9489, 0x8500, 0xb79b, 0xa612, 0xd2ad, 0xc324, 0xf1bf, 0xe036,0x18c1, 0x0948, 0x3bd3, 0x2a5a, 0x5ee5, 0x4f6c, 0x7df7, 0x6c7e,0xa50a, 0xb483, 0x8618, 0x9791, 0xe32e, 0xf2a7, 0xc03c, 0xd1b5, 0x2942, 0x38cb, 0x0a50, 0x1bd9, 0x6f66, 0x7eef, 0x4c74, 0x5dfd, 0xb58b, 0xa402, 0x9699, 0x8710, 0xf3af, 0xe226, 0xd0bd, 0xc134,0x39c3, 0x284a, 0x1ad1, 0x0b58, 0x7fe7, 0x6e6e, 0x5cf5, 0x4d7c,0xc60c, 0xd785, 0xe51e, 0xf497, 0x8028, 0x91a1, 0xa33a, 0xb2b3,	0x4a44, 0x5bcd, 0x6956, 0x78df, 0x0c60, 0x1de9, 0x2f72, 0x3efb,	0xd68d, 0xc704, 0xf59f, 0xe416, 0x90a9, 0x8120, 0xb3bb, 0xa232,	0x5ac5, 0x4b4c, 0x79d7, 0x685e, 0x1ce1, 0x0d68, 0x3ff3, 0x2e7a,	0xe70e, 0xf687, 0xc41c, 0xd595, 0xa12a, 0xb0a3, 0x8238, 0x93b1,	0x6b46, 0x7acf, 0x4854, 0x59dd, 0x2d62, 0x3ceb, 0x0e70, 0x1ff9,	0xf78f, 0xe606, 0xd49d, 0xc514, 0xb1ab, 0xa022, 0x92b9, 0x8330,	0x7bc7, 0x6a4e, 0x58d5, 0x495c, 0x3de3, 0x2c6a, 0x1ef1, 0x0f78};
const int list_nb_bits[NB_INFORMATION] = {6,2,30,4,8,10,1,28,27,12,9,6,2,3,1,19};
const int A_crcLookupTable[256] = {0 , 49345 , 49537 , 320 , 49921 , 960 , 640 , 49729 , 50689 , 1728 , 1920 , 51009 , 1280 , 50625 , 50305 , 1088 , 52225 , 3264 , 3456 , 52545 , 3840 , 53185 , 52865 , 3648 , 2560 , 51905 , 52097 , 2880 , 51457 , 2496 , 2176 , 51265 , 55297 , 6336 , 6528 , 55617 , 6912 , 56257 , 55937 , 6720 , 7680 , 57025 , 57217 , 8000 , 56577 , 7616 , 7296 , 56385 , 5120 , 54465 , 54657 , 5440 , 55041 , 6080 , 5760 , 54849 , 53761 , 4800 , 4992 , 54081 , 4352 , 53697 , 53377 , 4160 , 61441 , 12480 , 12672 , 61761 , 13056 , 62401 , 62081 , 12864 , 13824 , 63169 , 63361 , 14144 , 62721 , 13760 , 13440 , 62529 , 15360 , 64705 , 64897 , 15680 , 65281 , 16320 , 16000 , 65089 , 64001 , 15040 , 15232 , 64321 , 14592 , 63937 , 63617 , 14400 , 10240 , 59585 , 59777 , 10560 , 60161 , 11200 , 10880 , 59969 , 60929 , 11968 , 12160 , 61249 , 11520 , 60865 , 60545 , 11328 , 58369 , 9408 , 9600 , 58689 , 9984 , 59329 , 59009 , 9792 , 8704 , 58049 , 58241 , 9024 , 57601 , 8640 , 8320 , 57409 , 40961 , 24768 , 24960 , 41281 , 25344 , 41921 , 41601 , 25152 , 26112 , 42689 , 42881 , 26432 , 42241 , 26048 , 25728 , 42049 , 27648 , 44225 , 44417 , 27968 , 44801 , 28608 , 28288 , 44609 , 43521 , 27328 , 27520 , 43841 , 26880 , 43457 , 43137 , 26688 , 30720 , 47297 , 47489 , 31040 , 47873 , 31680 , 31360 , 47681 , 48641 , 32448 , 32640 , 48961 , 32000 , 48577 , 48257 , 31808 , 46081 , 29888 , 30080 , 46401 , 30464 , 47041 , 46721 , 30272 , 29184 , 45761 , 45953 , 29504 , 45313 , 29120 , 28800 , 45121 , 20480 , 37057 , 37249 , 20800 , 37633 , 21440 , 21120 , 37441 , 38401 , 22208 , 22400 , 38721 , 21760 , 38337 , 38017 , 21568 , 39937 , 23744 , 23936 , 40257 , 24320 , 40897 , 40577 , 24128 , 23040 , 39617 , 39809 , 23360 , 39169 , 22976 , 22656 , 38977 , 34817 , 18624 , 18816 , 35137 , 19200 , 35777 , 35457 , 19008 , 19968 , 36545 , 36737 , 20288 , 36097 , 19904 , 19584 , 35905 , 17408 , 33985 , 34177 , 17728 , 34561 , 18368 , 18048 , 34369 , 33281 , 17088 , 17280 , 33601 , 16640 , 33217 , 32897 , 16448};
const phase_t G[81]={0,1.08155554328355e-10,3.76338947187895e-10,1.02679527435555e-09,2.56998616153890e-09,6.15135639426468e-09,1.42819174318578e-08,3.23390223416717e-08,7.15716713804235e-08,1.54965851615047e-07,3.28398298078803e-07,6.81297493593830e-07,1.38391240185472e-06,2.75275237683629e-06,5.36239254283848e-06,1.02312508588880e-05,1.91216296333306e-05,3.50104049102048e-05,6.28056575636950e-05,0.000110404542071899,0.000190205475644497,0.000321198110393947,0.000531750468123525,0.000863185713357781,0.00137418295188395,0.00214594088755247,0.00328790866435118,0.00494372095178580,0.00729679042863111,0.0105748370498768,0.0150525054499374,0.0210511791453779,0.0289351787386265,0.0391037537844768,0.0519786446702969,0.0679874733955611,0.0875437625630234,0.111024898850929,0.138749759136654,0.170957920649412,0.207792324694352,0.249286943270015,0.295360446570120,0.345816171469585,0.400347963962137,0.458550839237779,0.519934982086292,0.583941467555410,0.649958231299801,0.717335215415952,0.785398163328549,0.853461111241145,0.920838095357296,0.986854859101687,1.05086134457081,1.11224548741932,1.17044836269496,1.22498015518751,1.27543588008698,1.32150938338708,1.36300400196275,1.39983840600769,1.43204656752044,1.45977142780617,1.48325256409407,1.50280885326154,1.51881768198680,1.53169257287262,1.54186114791847,1.54974514751172,1.55574382120716,1.56022148960722,1.56349953622847,1.56585260570531,1.56750841799275,1.56865038576955,1.56942214370521,1.56993314094374,1.57026457618897,1.57047512854670,1.57060612118145};
const phase_t DIFF_PHASE_COND2[LEN_DIFF_PHASE_COND2]={0,0.00435849101331048,0.0112131112012463,0.0179842887880147,0.0245773812005287,0.0309075791589922,0.0369022570189727,0.0425026489788368,0.0476647822416078,0.0523596516030548,0.0565726722249602,0.0603024935539319,0.0635592934774154,0.0663626953273960,0.0687394603496633,0.0707211054511162,0.0723415824523374,0.0736351336528853,0.0746344126194196,0.0753689320019845,0.0758638746318749,0.0758638746318749,0.0753689320019846,0.0746344126194196,0.0736351336528853,0.0723415824523375,0.0707211054511161,0.0687394603496634,0.0663626953273961,0.0635592934774154,0.0603024935539320,0.0565726722249604,0.0523596516030547,0.0476647822416076,0.0425026489788372,0.0369022570189725,0.0309075791589926,0.0245773812005290,0.0179842887880142,0.0112131112012461,0.00435849101331032,-0.00435849101331032,-0.0112131112012461,-0.0179842887880142,-0.0245773812005290,-0.0309075791589926,-0.0369022570189725,-0.0425026489788369,-0.0476647822416079,-0.0523596516030547,-0.0565726722249602,-0.0603024935539320,-0.0635592934774152,-0.0663626953273961,-0.0687394603496634,-0.0707211054511161,-0.0723415824523375,-0.0736351336528853,-0.0746344126194196,-0.0753689320019846,-0.0758638746318749,-0.0758638746318749,-0.0753689320019846,-0.0746344126194196,-0.0736351336528853,-0.0723415824523374,-0.0707211054511162,-0.0687394603496633,-0.0663626953273961,-0.0635592934774153,-0.0603024935539320,-0.0565726722249602,-0.0523596516030548,-0.0476647822416078,-0.0425026489788368,-0.0369022570189727,-0.0309075791589923,-0.0245773812005288,-0.0179842887880147,-0.0112131112012463,-0.00435849101331049,0.00435849101331048,0.0112131112012463,0.0179842887880147,0.0245773812005287,0.0309075791589922,0.0369022570189727,0.0425026489788369,0.0476647822416077,0.0523596516030548,0.0565726722249601,0.0603024935539320,0.0635592934774154,0.0663626953273961,0.0687394603496632,0.0707211054511162,0.0723415824523374,0.0736351336528853,0.0746344126194195,0.0753689320019847,0.0758638746318749,0.0758638746318749,0.0753689320019846,0.0746344126194196,0.0736351336528853,0.0723415824523375,0.0707211054511161,0.0687394603496634,0.0663626953273961,0.0635592934774152,0.0603024935539320,0.0565726722249604,0.0523596516030547,0.0476647822416076,0.0425026489788372,0.0369022570189725,0.0309075791589926,0.0245773812005290,0.0179842887880142,0.0112131112012461,0.00435849101331032,-0.00435849101331032,-0.0112131112012461,-0.0179842887880142,-0.0245773812005290,-0.0309075791589926,-0.0369022570189725,-0.0425026489788369,-0.0476647822416079,-0.0523596516030547,-0.0565726722249602,-0.0603024935539320,-0.0635592934774152,-0.0663626953273961,-0.0687394603496634,-0.0707211054511161,-0.0723415824523375,-0.0736351336528853,-0.0746344126194196,-0.0753689320019846,-0.0758638746318749,-0.0758638746318749,-0.0753689320019846,-0.0746344126194196,-0.0736351336528853,-0.0723415824523374,-0.0707211054511162,-0.0687394603496633,-0.0663626953273961,-0.0635592934774153,-0.0603024935539320,-0.0565726722249602,-0.0523596516030548,-0.0476647822416078,-0.0425026489788368,-0.0369022570189727,-0.0309075791589923,-0.0245773812005288,-0.0179842887880147,-0.0112131112012463,-0.00435849101331049,0.00435849101331048,0.0112131112012463,0.0179842887880147,0.0245773812005287,0.0309075791589922,0.0369022570189727,0.0425026489788369,0.0476647822416077,0.0523596516030548,0.0565726722249601,0.0603024935539320,0.0635592934774154,0.0663626953273961,0.0687394603496632,0.0707211054511162,0.0723415824523374,0.0736351336528853,0.0746344126194195,0.0753689320019847,0.0758638746318749,0.0758638746318749,0.0753689320019846,0.0746344126194196,0.0736351336528853,0.0723415824523375,0.0707211054511161,0.0687394603496634,0.0663626953273961,0.0635592934774152,0.0603024935539320,0.0565726722249604,0.0523596516030547,0.0476647822416076,0.0425026489788372,0.0369022570189725,0.0309075791589926,0.0245773812005290,0.0179842887880142,0.0112131112012461,0.00435849101331032,-0.00435849101331032,-0.0112131112012461,-0.0179842887880142,-0.0245773812005290,-0.0309075791589926,-0.0369022570189725,-0.0425026489788369,-0.0476647822416079,-0.0523596516030547,-0.0565726722249602,-0.0603024935539320,-0.0635592934774152,-0.0663626953273961,-0.0687394603496634,-0.0707211054511161,-0.0723415824523375,-0.0736351336528853,-0.0746344126194196,-0.0753689320019846,-0.0758638746318749,-0.0758638746318749,-0.0753689320019846,-0.0746344126194196,-0.0736351336528853,-0.0723415824523374,-0.0707211054511162,-0.0687394603496633,-0.0663626953273961,-0.0635592934774153,-0.0603024935539320,-0.0565726722249602,-0.0523596516030548,-0.0476647822416078,-0.0425026489788368,-0.0369022570189727,-0.0309075791589923,-0.0245773812005288,-0.0179842887880147,-0.0112131112012463,-0.00435849101331049,0.00435849101331048,0.0112131112012463,0.0179842887880147,0.0245773812005287,0.0309075791589922,0.0369022570189727,0.0425026489788369,0.0476647822416077,0.0523596516030548,0.0565726722249601,0.0603024935539320,0.0635592934774154,0.0663626953273961,0.0687394603496632,0.0707211054511162,0.0723415824523374,0.0736351336528853,0.0746344126194195,0.0753689320019847,0.0758638746318749,0.0758638746318749,0.0753689320019846,0.0746344126194196,0.0736351336528853,0.0723415824523375,0.0707211054511161,0.0687394603496634,0.0663626953273961,0.0635592934774152,0.0603024935539320,0.0565726722249604,0.0523596516030547,0.0476647822416076,0.0425026489788372,0.0369022570189725,0.0309075791589926,0.0245773812005290,0.0179842887880142,0.0112131112012461,0.00435849101331032,-0.00435849101331032,-0.0112131112012461,-0.0179842887880142,-0.0245773812005290,-0.0309075791589926,-0.0369022570189725,-0.0425026489788369,-0.0476647822416079,-0.0523596516030547,-0.0565726722249602,-0.0603024935539320,-0.0635592934774152,-0.0663626953273961,-0.0687394603496634,-0.0707211054511161,-0.0723415824523375,-0.0736351336528853,-0.0746344126194196,-0.0753689320019846,-0.0758638746318749,-0.0758638746318749,-0.0753689320019846,-0.0746344126194196,-0.0736351336528853,-0.0723415824523374,-0.0707211054511162,-0.0687394603496633,-0.0663626953273961,-0.0635592934774153,-0.0603024935539320,-0.0565726722249602,-0.0523596516030548,-0.0476647822416078,-0.0425026489788368,-0.0369022570189727,-0.0309075791589923,-0.0245773812005288,-0.0179842887880147,-0.0112131112012463,-0.00435849101331049,0.00435849101331048,0.0112131112012463,0.0179842887880147,0.0245773812005287,0.0309075791589922,0.0369022570189727,0.0425026489788369,0.0476647822416077,0.0523596516030548,0.0565726722249601,0.0603024935539320,0.0635592934774154,0.0663626953273961,0.0687394603496632,0.0707211054511162,0.0723415824523374,0.0736351336528853,0.0746344126194195,0.0753689320019847,0.0758638746318749,0.0758638746318749,0.0753689320019846,0.0746344126194196,0.0736351336528853,0.0723415824523375,0.0707211054511161,0.0687394603496634,0.0663626953273961,0.0635592934774152,0.0603024935539320,0.0565726722249604,0.0523596516030547,0.0476647822416076,0.0425026489788372,0.0369022570189725,0.0309075791589926,0.0245773812005290,0.0179842887880142,0.0112131112012461,0.00435849101331032,-0.00435849101331032,-0.0112131112012461,-0.0179842887880142,-0.0245773812005290,-0.0309075791589926,-0.0369022570189725,-0.0425026489788369,-0.0476647822416079,-0.0523596516030547,-0.0565726722249602,-0.0603024935539320,-0.0635592934774152,-0.0663626953273961,-0.0687394603496634,-0.0707211054511161,-0.0723415824523375,-0.0736351336528853,-0.0746344126194196,-0.0753689320019846,-0.0758638746318749,-0.0758638746318749,-0.0753689320019846,-0.0746344126194196,-0.0736351336528853,-0.0723415824523374,-0.0707211054511162,-0.0687394603496633,-0.0663626953273961,-0.0635592934774153,-0.0603024935539320,-0.0565726722249602,-0.0523596516030548,-0.0476647822416078,-0.0425026489788368,-0.0369022570189727,-0.0309075791589923,-0.0245773812005288,-0.0179842887880147,-0.0112131112012463,-0.00435849101331049,0.00435849101331048,0.0112131112012463,0.0179842887880147,0.0245773812005287,0.0309075791589922,0.0369022570189727,0.0425026489788369,0.0476647822416077,0.0523596516030548,0.0565726722249601,0.0603024935539320,0.0635592934774154,0.0663626953273961,0.0687394603496632,0.0707211054511162,0.0723415824523374,0.0736351336528853,0.0746344126194195,0.0753689320019847,0.0758638746318749,0.0758638746318749,0.0753689320019846,0.0746344126194196,0.0736351336528853,0.0723415824523375,0.0707211054511161,0.0687394603496634,0.0663626953273961,0.0635592934774152,0.0603024935539320,0.0565726722249604,0.0523596516030547,0.0476647822416076,0.0425026489788372,0.0369022570189725,0.0309075791589926,0.0245773812005290,0.0179842887880142,0.0112131112012461,0.00435849101331032,-0.00435849101331032,-0.0112131112012461,-0.0179842887880142,-0.0245773812005290,-0.0309075791589926,-0.0369022570189725,-0.0425026489788369,-0.0476647822416079,-0.0523596516030547,-0.0565726722249602,-0.0603024935539320,-0.0635592934774152,-0.0663626953273961,-0.0687394603496634,-0.0707211054511161,-0.0723415824523375,-0.0736351336528853,-0.0746344126194196,-0.0753689320019846,-0.0758638746318749,-0.0758638746318749,-0.0753689320019846,-0.0746344126194196,-0.0736351336528853,-0.0723415824523374,-0.0707211054511162,-0.0687394603496633,-0.0663626953273961,-0.0635592934774153,-0.0603024935539320,-0.0565726722249602,-0.0523596516030548,-0.0476647822416078,-0.0425026489788368,-0.0369022570189727,-0.0309075791589923,-0.0245773812005288,-0.0179842887880147,-0.0112131112012463};
const phase_t pi=3.1416;
const int POW_C[31]={0,0b1,0b11,0b111,0b1111,0b11111,0b111111,0b1111111,0b11111111,0b111111111,0b1111111111,0b11111111111,0b111111111111,0b1111111111111,0b11111111111111,0b111111111111111,0b1111111111111111,0b11111111111111111,0b111111111111111111,0b1111111111111111111,0b11111111111111111111,0b111111111111111111111,0b1111111111111111111111,0b11111111111111111111111,0b111111111111111111111111,0b1111111111111111111111111,0b11111111111111111111111111,0b111111111111111111111111111,0b1111111111111111111111111111,0b11111111111111111111111111111,0b111111111111111111111111111111};
const sin_cos_t cos_table[DATA_SIZE/4+1] = {1,0.9997,0.9988,0.99729,0.99518,0.99248,0.98918,0.98528,0.98079,0.9757,0.97003,0.96378,0.95694,0.94953,0.94154,0.93299,0.92388,0.91421,0.90399,0.89322,0.88192,0.87009,0.85773,0.84485,0.83147,0.81758,0.80321,0.78835,0.77301,0.75721,0.74095,0.72425,0.70711,0.68954,0.67156,0.65317,0.63439,0.61523,0.5957,0.57581,0.55557,0.535,0.5141,0.4929,0.4714,0.44961,0.42756,0.40524,0.38268,0.3599,0.33689,0.31368,0.29028,0.26671,0.24298,0.2191,0.19509,0.17096,0.14673,0.12241,0.098017,0.073565,0.049068,0.024541,0.0};
const sin_cos_t sin_table[DATA_SIZE/4+1] = {0,0.024541,0.049068,0.073565,0.098017,0.12241,0.14673,0.17096,0.19509,0.2191,0.24298,0.26671,0.29028,0.31368,0.33689,0.3599,0.38268,0.40524,0.42756,0.44961,0.4714,0.4929,0.5141,0.535,0.55557,0.57581,0.5957,0.61523,0.63439,0.65317,0.67156,0.68954,0.70711,0.72425,0.74095,0.75721,0.77301,0.78835,0.80321,0.81758,0.83147,0.84485,0.85773,0.87009,0.88192,0.89322,0.90399,0.91421,0.92388,0.93299,0.94154,0.94953,0.95694,0.96378,0.97003,0.9757,0.98079,0.98528,0.98918,0.99248,0.99518,0.99729,0.9988,0.9997,1};
const phase_t hanning[50]={0,0.00410499308837692,0.0163525684804853,0.0365416213269891,0.0643406479383053,0.0992931890660217,0.140825324951136,0.188255099070633,0.240803715844737,0.297608328438803,0.357736206684484,0.420200052483310,0.483974211214172,0.548011512953841,0.611260466978157,0.672682527210654,0.731269145120418,0.786058330061085,0.836150445130659,0.880722979184567,0.919044052445920,0.950484433951210,0.974527873505334,0.990779578495533,0.998972696375168,0.998972696375168,0.990779578495533,0.974527873505334,0.950484433951210,0.919044052445920,0.880722979184567,0.836150445130659,0.786058330061085,0.731269145120418,0.672682527210654,0.611260466978157,0.548011512953841,0.483974211214172,0.420200052483310,0.357736206684484,0.297608328438803,0.240803715844737,0.188255099070633,0.140825324951136,0.0992931890660217,0.0643406479383053,0.0365416213269891,0.0163525684804853,0.00410499308837692,0};
const sog_t noise_sog[256]={-0.12,0.16,-0.16,0.14,-0.10,-0.10,0.12,0.020,-0.040,0.020,-0.18,-0.10,0.020,-0.20,-0.040,0.16,0.040,-0.080,-0.040,0.18,0.14,0.20,0.10,0.0,-0.060,0.18,0.14,0.0,-0.060,0.14,-0.20,0.12,0.040,-0.18,0.0,0.040,-0.040,0.040,-0.20,-0.040,0.12,-0.18,-0.10,-0.020,0.18,0.10,0.0,-0.10,-0.060,-0.16,0.10,0.18,0.18,-0.020,-0.060,0.060,-0.18,-0.14,0.10,0.20,0.14,0.080,-0.12,0.080,0.14,0.040,-0.10,-0.14,0.14,-0.040,-0.14,0.12,-0.14,0.16,0.20,0.080,0.14,-0.12,-0.16,0.040,-0.080,0.080,0.12,-0.20,-0.020,0.020,0.14,-0.18,0.0,0.12,0.080,0.060,0.040,-0.18,-0.20,0.0,-0.080,-0.080,-0.14,0.060,-0.10,0.060,0.080,-0.060,-0.020,0.12,0.16,0.060,0.10,0.20,-0.10,-0.18,-0.020,-0.16,-0.080,0.060,0.20,-0.12,-0.16,-0.020,0.16,-0.12,-0.020,-0.12,0.12,0.12,-0.16,0.18,-0.16,0.060,-0.12,0.12,0.18,-0.18,0.16,-0.040,0.020,0.16,-0.16,-0.18,0.0,0.060,0.18,0.040,0.040,0.040,-0.18,-0.20,0.20,-0.16,0.10,0.20,-0.020,0.10,-0.14,0.0,0.12,0.16,-0.080,0.14,0.12,-0.12,0.16,-0.16,0.20,-0.040,0.080,-0.060,0.060,0.0,0.10,0.14,-0.12,0.0,-0.020,0.18,0.080,0.18,0.0,0.12,0.080,0.080,0.14,0.040,-0.080,0.0,-0.16,0.12,0.0,-0.16,-0.16,0.16,0.0,-0.040,0.040,0.0,0.0,-0.10,0.20,0.020,-0.10,0.060,0.10,-0.080,0.080,0.020,0.20,-0.20,-0.10,-0.14,-0.080,-0.18,0.10,0.18,-0.16,0.040,0.0,0.060,-0.18,0.14,-0.14,0.0,0.0,-0.18,0.10,0.12,0.0,0.060,0.0,-0.18,-0.10,-0.060,0.060,-0.12,-0.20,0.14,-0.080,-0.14,0.12,-0.12,-0.080,0.060,0.16,-0.020,0.14,-0.10,-0.060,0.060,-0.10,0.20,0.020,0.12,-0.060,-0.060,0.040,0.12};
const cog_t noise_cog[256]={0.04,-0.1,-0.03,0.08,0.07,-0.1,-0.07,-0.08,0.02,0,-0.04,-0.04,-0.08,-0.04,-0.1,0.06,0.05,0.1,-0.07,0.05,-0.08,-0.07,0.04,-0.07,-0.05,0.06,-0.05,-0.09,0.1,0.1,0.08,-0.1,-0.08,0.09,0.1,0.08,0.07,-0.08,-0.01,-0.07,-0.01,0.1,-0.04,-0.03,0,0.08,0.09,0.01,0.03,-0.01,-0.08,0.1,0.05,0.04,0.04,-0.07,-0.09,-0.09,-0.03,-0.06,-0.05,0.06,0.03,0.03,0.08,0.05,0.07,-0.06,0.07,-0.1,0.1,-0.09,-0.07,-0.09,-0.02,-0.07,0.02,0.07,0.1,0.06,0.09,-0.05,0.07,0.01,0.04,-0.01,0.01,-0.1,0.01,-0.07,0.01,-0.03,-0.04,0.04,0.09,-0.06,0.06,-0.04,-0.01,0,-0.07,-0.03,0.06,0.02,-0.02,-0.08,0.05,0.03,-0.03,0.1,-0.06,0.02,0.02,-0.01,-0.09,0.05,0.02,-0.06,0.09,0.07,0.09,0.06,-0.07,0.02,0.06,0.1,0,0.09,0.08,-0.07,-0.03,-0.08,-0.05,-0.04,0.1,0,-0.09,0.01,-0.08,0.1,0.09,-0.03,-0.03,-0.05,-0.07,-0.07,-0.08,-0.05,0.01,-0.06,-0.03,0.04,0.04,0.03,-0.1,-0.01,0.06,0.05,0.06,0.07,-0.07,-0.01,0.09,0.09,0,-0.03,0.05,-0.03,-0.07,-0.03,0.1,0.03,0.1,-0.02,0.02,-0.03,-0.02,-0.09,0.02,0,0.01,0,-0.01,-0.03,0.06,-0.04,-0.05,-0.01,-0.07,0,-0.01,-0.1,-0.09,0.06,-0.04,-0.08,-0.09,-0.1,-0.01,0.07,-0.08,-0.1,0.05,-0.03,-0.04,-0.01,0.08,0.04,-0.02,-0.09,-0.09,0.01,0.07,0.07,-0.06,0.09,-0.07,-0.01,-0.09,-0.1,-0.1,-0.07,0.02,0.06,0.02,0.08,-0.05,0.06,-0.09,-0.04,0.1,0.08,-0.06,-0.1,0.05,-0.07,0.05,-0.04,-0.05,0.01,0.1,-0.1,0.01,0.07,0.04,-0.04,-0.03,-0.05,-0.1,0.09,0.03,0.04,0.04,0.06,0.1,-0.06};
const ap_uint<12> noise_TS_6s[256]={220,212,204,221,223,230,238,229,235,211,227,204,204,238,220,228,228,208,220,223,211,206,204,234,241,204,224,238,224,212,244,236,203,210,204,204,227,208,244,221,215,235,231,226,225,237,222,213,240,235,245,209,232,237,237,213,236,222,244,228,222,237,208,210,206,231,220,244,207,206,217,231,243,205,231,217,212,231,219,224,226,224,233,232,213,244,239,246,205,228,211,247,232,214,228,245,240,219,236,233,237,246,214,222,213,246,241,230,219,237,244,216,228,208,241,216,203,221,247,220,208,226,218,203,226,244,240,224,229,209,247,217,236,203,232,219,203,223,220,239,224,234,207,226,239,214,242,215,231,238,231,235,218,233,226,233,238,204,234,206,215,222,237,217,237,226,211,241,209,220,218,247,232,229,232,210,232,246,246,242,226,230,221,233,240,235,232,212,221,216,227,247,221,212,230,232,220,246,209,234,231,204,241,220,240,244,236,234,246,219,244,203,243,212,223,218,216,243,203,210,235,207,227,215,205,244,219,223,229,219,234,216,227,209,231,222,208,215,243,234,223,215,240,239,207,235,227,232,220,208,216,222,233,224,204,236};
const ap_uint<12> noise_TS_10s[256]={349,376,389,397,340,398,354,405,391,364,350,364,338,384,349,401,411,404,401,398,385,389,353,376,358,384,338,381,359,392,399,402,356,394,375,405,361,392,384,381,391,360,355,381,350,398,356,344,358,366,396,395,384,345,358,341,403,341,343,369,370,362,339,384,389,353,367,410,354,402,341,348,375,340,395,358,400,408,359,411,363,393,355,372,353,395,371,386,344,340,409,399,344,383,373,365,389,364,406,393,345,408,351,403,354,389,348,368,386,338,394,374,403,350,378,391,403,408,338,411,388,408,379,363,387,406,368,397,389,360,340,380,388,361,344,370,407,398,385,349,411,347,389,385,360,404,410,348,376,357,364,341,368,358,384,385,400,395,359,407,388,358,409,396,401,363,344,364,356,391,374,394,349,396,357,361,341,373,401,395,389,347,378,406,342,338,347,342,374,364,379,362,361,383,342,405,373,407,342,339,359,408,355,364,390,409,383,362,377,407,364,357,400,406,341,340,389,382,373,371,356,400,405,390,365,397,405,363,412,365,359,412,340,349,388,403,381,364,409,409,378,347,366,342,341,396,374,375,377,346,408,411,380,402,412,359};
const ap_uint<12> noise_TS_2s[256]={78,78,81,79,81,69,72,81,67,73,71,75,69,75,73,75,78,75,67,77,75,80,69,70,81,71,78,80,79,79,72,73,79,71,79,74,68,78,76,78,81,70,78,72,68,80,73,75,72,67,79,70,78,68,78,75,67,74,75,77,81,70,68,70,69,74,69,70,71,80,75,81,79,71,75,78,72,72,82,72,72,71,70,75,74,69,76,75,82,74,81,74,81,72,71,79,72,72,69,79,76,68,77,78,78,72,82,79,81,78,67,71,79,82,70,74,78,81,72,77,77,72,70,77,75,68,80,79,78,75,67,72,72,81,70,76,79,77,69,72,82,69,67,69,76,69,67,80,69,79,68,72,69,69,69,81,77,70,81,70,80,69,79,72,71,70,69,80,68,73,73,69,75,68,75,75,70,78,75,72,82,77,67,78,74,79,81,78,75,78,78,75,78,72,76,73,80,70,81,73,69,68,68,72,75,67,77,71,75,70,71,70,77,67,79,81,74,79,69,81,75,68,69,75,68,71,69,67,78,70,81,72,75,71,72,81,69,72,74,78,70,80,74,78,74,72,69,73,75,78,69,78,80,79,81,75};
const sin_cos_t gaussian[LEN_GAUSSIAN]={8.31364710438904e-09,2.37602034388632e-08,6.55313494766881e-08,1.74416856700663e-07,4.47989863022998e-07,1.11042263539447e-06,2.65612685360329e-06,6.13125962687299e-06,1.36581220136618e-05,2.93611226440696e-05,6.09108575133606e-05,0.000121943079295830,0.000235591701657556,0.000439241340223974,0.000790290596595171,0.00137217912584203,0.00229919173591703,0.00371774808587259,0.00580129720239534,0.00873596044541603,0.0126951135680517,0.0178033983474830,0.0240940393644404,0.0314670992101097,0.0396592220335906,0.0482360858592467,0.0566161477314418,0.0641281866576344,0.0700967674805297,0.0739413558105509,0.0752691854009981,0.0739413558105509,0.0700967674805297,0.0641281866576344,0.0566161477314418,0.0482360858592467,0.0396592220335906,0.0314670992101097,0.0240940393644404,0.0178033983474830,0.0126951135680517,0.00873596044541603,0.00580129720239534,0.00371774808587259,0.00229919173591703,0.00137217912584203,0.000790290596595171,0.000439241340223974,0.000235591701657556,0.000121943079295830,6.09108575133606e-05,2.93611226440696e-05,1.36581220136618e-05,6.13125962687299e-06,2.65612685360329e-06,1.11042263539447e-06,4.47989863022998e-07,1.74416856700663e-07,6.55313494766881e-08,2.37602034388632e-08,8.31364710438904e-09};
//L'écart type de rand est égal à 1, il s'agit d'une variable gaussienne
const sin_cos_t rand_gaussian[256] = {-1.07525932862726,0.475063751712385,0.0161533524100730,-0.832822296144288,-0.236582488671877,-1.29362018388369,0.304048559844573,-0.123031957084119,1.15346257643874,-0.961260772488528,0.686251856007303,0.101568684043917,0.0584095594583776,0.506757984526306,0.843920532060587,-0.757355145816026,0.932604695926820,-0.855601426395751,-0.759513930817442,-0.475571794626524,0.520757402679442,-0.756576461482137,0.236679330782598,0.291244976157631,0.108979429723312,0.392140700970045,-0.829327139592751,0.712471378277151,0.0802709598681243,0.516223918980988,-0.695447849381727,0.0367918665910286,0.620556467526791,0.717106007129767,-0.0596433332496524,-1.31064474677780,-0.775569361687375,0.154593077977774,0.561616626973618,0.327478258767618,-0.433194844484726,1.58703032579688,0.0511574844735322,0.612011098840259,-0.293941790445105,-0.788380295303730,0.484546638615921,0.733745767179770,1.28849812850990,-0.374051350624227,-1.15114631644729,1.14360551669009,0.186772881368794,-0.797012711268152,-0.395397041799618,-0.571939895117463,0.820954003331967,0.418681650989804,0.171648519674210,0.170043260139469,-0.580888502772182,0.702236318923942,0.244938058674001,-0.184649287996052,-0.130611747760376,-0.0719375080861488,-0.627234222205841,0.524232772921012,0.984439626326138,1.74931167059732,0.356324713677101,-0.581581577007663,0.142115643629586,-0.712093671212722,-0.433577768272249,-0.465957482223376,-0.589182107767211,0.267413145333260,-0.788666312983587,0.471810884508112,0.562385218772410,0.733617525635027,-0.0144470348370814,0.437665924254470,1.27495843533764,0.0374719297725002,-0.125787286706314,1.25333443909358,-1.77399204747481,-0.322857309183956,1.71853643721188,-0.333368381157086,-0.396212075783006,-0.867243396892325,0.560700579244636,-1.49195318725676,-0.565257714446284,0.400911932952920,-0.00102028357028278,0.441181362458285,0.0894071690434815,0.481446234361536,-0.910340522898403,0.154209278094303,-1.10773020099387,0.553863964875646,-0.219606088489509,0.463384335300251,-0.380046814689614,0.232385979032570,0.745341438856100,-1.39985881328431,-1.32044284842924,-1.29567112052765,0.600045239077025,0.286510659240013,-0.496711426937006,1.05998560696109,0.0974356839706305,-1.12205217240366,-0.720644704557552,-0.979508171807843,0.675206670133200,-0.425056254136229,-0.828651934421281,-0.408078611640754,-0.591445695832183,0.603140538870143,0.337524113313977,0.213772575083775,0.293998163841826,0.0303877932216818,-0.670940553324188,0.382974948526602,-0.580625359964030,-0.757951328546448,-0.759497479698823,0.614866686651010,0.693708107903467,-1.24367734544113,-0.104719655861968,0.178149717184599,-0.431607108100838,0.538093984151471,0.179908826375169,-0.108069729356097,-0.394149009767540,0.478723776139856,0.600543979366815,0.331850291268908,-0.169551269248824,0.651235059763151,-0.641261972403455,0.102134932176081,0.987410293137466,-0.134137279299292,-0.596682080611657,1.37421822386300,-0.174599895761527,0.312271899814662,-0.568239129931604,0.203370580198551,0.330231661030196,0.00322554505435696,0.230580703847922,0.851771435788070,-0.992859826428695,0.145355384026574,-1.40798804537045,0.0200881498198891,1.36508053671389,0.665484205049906,-0.00489632647154977,-0.239172962465960,0.373540317909920,0.747340870191241,0.0104231899584576,1.14180864183106,-0.576896575993195,-1.41262902401687,-0.529051218444872,-0.140929224511207,-0.263581178888525,-0.599181893534436,0.945570088356556,-1.14290889364377,-0.347767556482971,-0.685399711045701,-0.335244925618826,-0.471048958175911,0.338261982378585,-0.736139265462299,-0.580293608046355,0.0715094301905938,0.766491402504744,-1.31134878544865,1.27261739929014,-0.621104427894605,0.458016203257375,0.742154551602013,0.935568298910609,-0.365828032910271,0.0171932658248976,-0.114810717329768,-0.428267061059056,0.192127816645372,0.253599188779696,-0.249124412432795,0.0935926027873866,1.89050780471449,-0.00535002325380419,0.502260023209990,-0.327064720010704,-0.373266043152857,-0.244508379854778,0.399202630179151,-0.566773764110328,-1.31023123697027,0.0376294068088902,-0.308592159392511,0.197995182422308,0.0598253965539522,0.515565031312990,0.636928622105940,-0.937367827464047,-1.07804002807519,0.355274016902908,0.216651454774175,-0.664086733649139,0.874975434653411,0.0233429486418138,0.0873759957540496,0.193704392914382,0.533275757175526,1.07798252420634,-0.185244837997523,-1.22377804443397,0.716627479013464,-0.656008486362929,0.879414764016721,-0.416831455495809,1.05463684868344,-0.569912576260272,-0.786726334943519,0.676658457788795,-0.963823021644656,0.481246242315838,0.309588052479887,-0.101305453775761,-0.241499949998679,1.45509185374458,-0.264836263341524,-0.134493970722268,-0.663784053263125,-0.575204754095382,-0.412680776833498};
//L'écart type de rand est égal à sqrt(12.5), il s'agit d'une variable gaussienne commande matlab randn(1,256)*sqrt(12.5/2).
const sin_cos_t rand_gaussian_12_5[1024]={1.31618762148887,0.662046479409008,-0.983994726448529,-5.44077509584063,-2.98913608006396,0.913320981079615,6.03110764292655,1.85061805144849,0.774365971518426,-1.35496795778329,0.305707960346248,2.40569833192515,-0.634937108308162,4.72938997315908,-3.05063534306909,-0.940592859971684,0.131072871943058,-4.88483425152133,1.41355142790050,0.194486156000695,0.201752969065806,1.98676952359366,2.60922234119679,2.00546162006884,-1.17206091208907,-0.116480935816487,0.883632586956065,-3.14200140796073,-2.59007859469884,-1.06740671940883,0.194171698580076,4.47732564740151,1.99315783851726,-1.10625185206176,-1.57272772878704,3.83449067831528,6.83385095328311,0.418597693712618,-1.19716291400670,-3.53163470795451,2.43747013767243,0.724297460546338,2.91352062773038,-2.27176404079721,0.601437593073631,-1.63511583797906,3.18738634576679,-1.37797652733985,-0.218522170704468,-0.869550795649353,2.48490633538900,1.07109043255953,-2.51046320040493,-1.58171969165769,-2.61427497806234,1.26426752364688,0.829884303491890,-4.08853130672028,-4.76710051329047,-0.100996802606246,1.74298332411604,0.422006438721674,-3.85949081432807,-3.87950598535426,2.16769450904846,-0.363432476058493,-0.965604159542531,3.29051028090701,-1.99116056648471,0.338603429713988,1.04451607552149,2.04969911490925,-2.13588344780002,0.893296470462792,6.87116638968803,-3.78244248382049,1.08494758193400,-0.574419333660055,-2.06771594074773,-2.07995653848359,1.24474875145826,5.78906525836125,-1.98456425413134,1.35239892320494,-1.39765339277900,4.94141514581668,1.36165093822359,-0.344763894444852,1.54968908937666,-0.0139569586122641,2.76799811356050,-0.463975271092858,-2.80354453127976,0.616123790997779,3.90259307546297,-2.99155428640680,-0.605863194980509,2.51207040860624,-4.80031451281846,1.56361444865200,1.88240104445649,0.533709208806763,-1.92558518217143,-0.0178366313218569,0.232966311943588,2.33812801847680,1.65879480457901,-0.875581666838014,4.04969359838742,-0.127082741204032,-2.03174267691651,-1.09604983674232,2.14652498658873,0.488039838095845,2.22215538470677,0.173054552598125,6.21705330074336,-4.16410779470375,-1.03981986213005,-0.210561516177237,0.223129868768723,3.64036800118837,0.548633796595206,-0.287193129798302,0.171506173707747,1.87873714242525,-1.72356764480794,1.12703396131104,-3.91256164464182,-0.196989809156072,-2.35447992265259,-1.63215376454054,0.706323099792469,-2.81269760746342,-2.47243521785796,-3.78964690262242,-5.57127619218288,-0.378804195758261,2.90686091401590,-0.454840715388385,-0.584883850827385,-2.61683517470842,3.95829719446760,-0.623533553811481,3.23504752088765,0.904950344800773,-0.657631271759134,2.70536112979139,2.45608520048223,-0.278609910722138,3.23987696372359,4.45323755375895,-0.164037189347601,-0.639202163424708,1.01159539259867,0.879391883317744,2.01877765052071,-0.638976230769454,1.78778319696422,2.62149328215899,0.443871387541374,0.383244212069960,-3.13581119579093,-2.93200214577211,-3.65360453769449,-3.11071996776601,-0.387748438336909,-4.03728453375400,5.61516287446207,1.84820283077430,-5.16911340658322,-2.88637645351075,-0.267979695318489,-4.28219771632215,-1.14973635531593,2.72750025843232,-0.409700641891817,-0.168101175610837,-2.50398113996159,-1.38915361783660,-3.37889085630499,0.910528306837021,-1.13051901244633,1.95841492471515,3.09309161969939,2.69299545358365,-0.0871028090093469,-1.25996833490675,-3.06004743702197,0.296272706968746,2.39868375183843,-0.852326096485179,-0.433295827460393,1.54075126918710,2.15979842396924,-3.54228541744063,0.499879896537589,0.489567132049508,-0.377831007345461,2.23196040758605,-0.910475470209063,-2.06547172140090,0.690028263171939,1.14949325243170,-0.543766675963122,1.99030741857851,-3.79505641971452,-2.68729258096489,-7.68041433493003,1.30351797156430,-2.47755906618889,-0.632814343758329,2.52316315589741,0.127530132743026,-1.10108197752698,-2.12117352826084,-0.600927098134563,1.50732359040383,-3.79063412756586,-0.170871255703566,1.95598216302433,-3.55181480768712,1.67341282705756,1.70809159431105,-2.20534055806735,-3.76127188869976,1.08284849711491,2.02063928359379,1.44734496455481,1.90712281451795,-2.95531758486349,1.45961922526053,-1.45002420470992,-1.40341797298087,-3.88974120464695,2.75052114073807,0.437645754752949,2.50902827583268,3.77752043569742,-2.84309757578943,1.60754598290343,-0.0319001101400808,2.28564931252343,2.76923644008507,2.05117865366573,-2.04402958063736,-0.316213052763029,0.660357264471639,7.89632018232589,3.06654307127927,5.80158830338369,1.03624465159755,0.529578916950716,1.53291722925627,-1.31944240204046,3.10400312838132,-0.394076707031309,-3.43400446148400,2.17709538679477,-3.92133325535296,-4.61063223978890,0.721024524259216,-2.37727781878301,-2.27683023516997,-0.404872925756468,-1.22225441429736,-0.556955019838783,0.680166241095135,-2.92132723457610,-3.06058576732306,-5.24869674906415,-0.975606575148845,1.66070439439759,-1.75566001795045,1.25331883577118,1.35078436424436,2.47687746632994,2.47344529175497,-1.72210295729539,-2.14209401650138,0.120975044149366,-1.66213350716896,3.63185490247459,3.44961438036109,0.237841047424236,-1.06781765995986,1.27701952460405,-1.64068406095116,-0.312541939871624,-1.32616675076815,0.263965998167364,2.82087601656850,1.85619510273909,2.85900788629725,-2.28678561263856,0.449504179811081,-2.45836955050213,0.962071426879947,0.814244080599175,3.24077592139919,2.74807370873002,1.63305762187294,-1.26268346817852,-1.18998451745847,-5.12890355457813,-1.12076134484860,-3.87799133715242,2.32456444617368,2.25484992964746,0.345718622634309,-0.946019396253881,0.357660643465072,4.01259666605039,3.37279013572837,-1.12110527837739,0.421028302304164,-2.80124173753184,1.00182726890772,1.84765661175747,2.25011176157407,-3.82804568039770,1.26155196716619,-2.16053661484737,-0.941387379967751,1.97002601261692,0.745514103742386,-0.409354592012133,1.51683136383617,4.08624669727479,-1.55873431079170,-3.37525041485805,-2.90560244761264,-2.36069800357888,-1.67802734968486,1.44170292465455,-5.21442521940511,0.589909708945097,-1.94605337500068,2.74890486348845,-2.13891073909010,0.0188940589078752,-2.34396442200529,-1.70389920627296,-0.650348575977660,-0.571988410772029,-1.31203248497478,2.82079628688835,1.37534812380537,4.63786840174807,-0.693246986326563,2.66657692718132,-5.24809712747592,1.59620942354588,0.928663641642755,-0.935448249785304,1.73837081537812,2.19407185217822,2.58401412146666,1.04947830092412,1.50267306970314,-1.68504578429272,-2.73794614225592,-0.669041814214594,0.466375929753267,2.37736167957522,-1.97629684224141,-1.22369495483114,7.43618467650495,-1.55646339217878,4.80075747528158,2.40287231687830,-1.39450791156028,-0.266387878914099,-0.537903116257231,1.18372423024613,3.41410239598119,-4.09450929017284,5.05932216241747,1.94447321397093,-1.37225480807454,-0.315028400291086,0.748951018249824,0.740427960023057,3.00195729387102,2.72543206683693,-0.896758063364936,-0.324819076225666,1.83434380943953,0.300828925792110,2.84082821172061,-1.71693279679804,1.17920715860693,0.720856163639835,3.47963708761702,-3.36375502540274,0.00186851547933558,0.133737018934419,-5.85476298477919,3.12023786138541,7.02307963391270,-0.580462154439067,0.717580367233476,-1.16151122473340,0.960794441780660,-0.949568808383283,-0.254445568863742,4.04537785425782,-2.11807470662465,-1.43970794178206,-0.189782820921371,-0.331178980444333,3.59827416534205,5.07815728756184,-2.44550402512558,-1.60255916998095,1.30118917379010,-0.951749990384981,4.98212985310845,4.08967562037362,1.39754722832376,1.40909396101756,-0.845991553310691,1.90911842896339,2.81860586509324,0.353927918157635,4.82033525742538,1.67659477388333,-0.275278092498507,0.927405645029783,2.74148673337084,-0.995407767887700,-0.213656378221258,5.93321852788254,-1.18480254983814,2.36585214604562,2.04540393966747,3.97242721109709,1.31502999303014,-6.16299388165518,-2.13131985641130,1.27933853190120,0.644437278436019,4.90611848750416,3.51578727231309,1.24208432981146,0.207076405688811,-3.87119466244112,4.65789908282560,0.335066554547269,-3.86500643456553,1.08320599047908,0.257385549968662,-1.42586524969160,1.23265539173438,-1.76878303376994,-3.37006258992713,-4.38575382734050,-0.909522386618435,-1.56773501406530,1.10037563178513,-3.75660282227287,-0.520588610874929,-3.76281364895807,4.52435205668714,-0.292431419379682,3.06552246292517,1.23735786116020,2.27148713589429,-2.88554708692145,3.14388879357836,3.63133104184812,-5.19202871290775,-0.441220010166393,-1.63020547868937,0.391334509231600,-2.12556448576837,0.697614796770408,1.49273432626526,0.611791769515876,-0.295866277687709,-3.22351970486290,0.143909104322085,-1.30233221818116,-3.19756722944912,-0.140568078750251,-0.524200707930496,0.480253896298481,2.48083072247744,1.44061048444674,3.26445942889538,-1.82326457966376,-2.16143671894561,-0.237302478516441,3.45803478892026,3.25920343382361,-0.314530451390092,-1.49218446239006,-3.80161581403215,1.67960400165875,0.0571107251402934,-2.94447146563489,-0.836445410249368,-4.57363802151974,1.07497399238051,-0.434983655784163,4.07810604822369,-3.39857005357629,2.42626670492309,0.359099526218238,0.206508977895688,1.79166003639489,2.98370965501300,-2.67765479686519,3.29725552328136,-3.02500785298659,-2.68528725443332,-1.68140020460735,1.84115545393864,-2.67490173200071,0.836787798815344,1.02970648813787,0.385300468835984,1.38642674417582,-2.93211422114039,2.51896671490550,0.283800700275520,1.82512716861076,-2.45877945129710,0.130078891795135,2.19399843148682,2.53535260235533,-0.210871026966992,-4.63382894086553,-2.74205177464832,0.546569068812923,1.98561462680081,1.15781048732873,-1.53157506055101,5.61099952659833,0.180869020898401,2.16378599075689,-1.03924116648925,-2.78734526481560,1.71313106983233,2.59418303819870,4.55552882107765,-1.32247123269189,-4.06991683248897,4.04325607926953,0.660341854788125,-2.81786546414793,-1.39793964758805,-2.02211289134341,2.90251071399139,1.48026317286635,0.606869161211332,0.601193711698432,-2.05375099711755,2.48278031553299,0.865986811295272,-0.652833818416381,-0.461782262719944,-0.254337498946890,-2.21760785957010,1.85344274326338,3.48051967721982,6.18475072344067,1.25979810672716,-2.05620138457642,0.502454676615856,-2.51763131877270,-1.53292890058518,-1.64740847712380,-2.08307331877989,0.945448242217859,-2.78835649002043,1.66810337936654,1.98833200916525,2.59372963586912,-0.0510779815066929,1.54738271467307,4.50765877679118,0.132483278231405,-0.444725217085454,4.43120640488853,-6.27200903270222,-1.14147296339809,6.07594384234345,-1.17863521474678,-1.40082122787081,-3.06616843440910,1.98237590899554,-5.27485107961067,-1.99848781501488,1.41743773224808,-0.00360724715640087,1.55981166563687,0.316102077586689,1.70216948546885,-3.21853978465184,0.545212131311819,-3.91641768423951,1.95820482709219,-0.776424771803925,1.63831102893214,-1.34366839917687,0.821608508133024,2.63517992857243,-4.94924829788546,-4.66847046146797,-4.58088917756338,2.12148028785034,1.01296815015421,-1.75614009140002,3.74761505321161,0.344487164325911,-3.96705349975863,-2.54786378709410,-3.46308435256482,2.38721607576787,-1.50280079842740,-2.92972701036319,-1.44277576774184,-2.09107631113266,2.13242382521793,1.19332794669145,0.755800187367239,1.03944047654474,0.107437073261729,-2.37213307514294,1.35402091563865,-2.05282064679723,-2.67976262112273,-2.68522909094565,2.17388201828317,2.45262853631315,-4.39706342284753,-0.370239893917597,0.629854365438478,-1.52596156473209,1.90244952554596,0.636073755625975,-0.382084192343456,-1.39352718802295,1.69254414211861,2.12324360105514,1.17326795647488,-0.599454261223146,2.30246363452475,-2.26720344601772,0.361101515688674,3.49102257045450,-0.474246899012215,-2.10958972706500,4.85859512461829,-0.617303851437202,1.10404788966477,-2.00902871055090,0.719023581761191,1.16754523438475,0.0114040239047927,0.815225896508163,3.01146679133373,-3.51028958017714,0.513908888635827,-4.97798947355518,0.0710223347956744,4.82628852188083,2.35284197081664,-0.0173111282546802,-0.845604118180778,1.32066445920341,2.64224898585041,0.0368515415061046,4.03690316728072,-2.03963740464044,-4.99439781091631,-1.87047852078687,-0.498260051596180,-0.931900194926104,-2.11842790041198,3.34309510782042,-4.04079314486964,-1.22954398732892,-2.42325391751858,-1.18526980131726,-1.66540956298522,1.19593670778751,-2.60264533253038,-2.05164772664393,0.252824015032774,2.70995634216146,-4.63631809345743,4.49938196447023,-2.19593576394633,1.61933181608303,2.62391258063123,3.30773344211427,-1.29339741409494,0.0607873742776401,-0.405917183883854,-1.51415271516846,0.679274410022540,0.896608530447652,-0.880787806951717,0.330899820499300,6.68395444299853,-0.0189151886113533,1.77575734165348,-1.15634840703224,-1.31969475150028,-0.864467667261248,1.41139443433591,-2.00384786000519,-4.63236696292056,0.133040043632967,-1.09103804263722,0.700018680665408,0.211514717952370,1.82279764892035,2.25188273911457,-3.31409573632965,-3.81144707121253,1.25608333265715,0.765978564123749,-2.34790116329665,3.09350531607537,0.0825297863875794,0.308920795553077,0.684848448876914,1.88541452070602,3.81124376433449,-0.654939405639261,-4.32670876943236,2.53366074997520,-2.31934024611575,3.10920071555895,-1.47372174396473,3.72870433696634,-2.01494523678567,-2.78149763188301,2.39234892024844,-3.40762897234323,1.70146240681037,1.09455905641432,-0.358168866680103,-0.853831261501390,5.14452658516047,-0.936337588564489,-0.475507993632104,-2.34683102652924,-2.03365591095793,-1.45904687882149,4.27381342630967,-0.976049544427595,-1.72516340819949,-1.12055175482273,1.78594087524903,-3.28932812070777,1.56780523815788,-3.32823710815171,-0.327120379399165,-4.56724042679491,1.33980616277539,1.73216178859159,-1.71887438770186,0.793939391101060,0.407105850310676,2.89778976457660,0.320970146659004,2.59864533325431,-0.291927853261324,-1.62074227526062,-0.0949530122190983,-0.498312046930286,2.20417468003923,-0.140360177267333,-2.10309717346850,-0.387109595215105,2.97148667616068,-1.03726819808962,-1.64654190627849,2.45997667024663,0.253068736396409,-0.906764560300347,-1.84706957956280,-3.69960602557486,0.383429373680989,-0.792543679652452,0.797295631007623,-3.64136646986716,3.30458625471197,1.21800984387773,-3.91656562286643,2.64264907237382,-1.46894449144824,0.755554044830966,0.548655971052456,-2.19550275378084,-7.15349939817711,1.33888824146313,-0.855093274755042,-1.49464713684010,1.04728177102576,-1.72420180193427,1.67797760322735,0.377243651297543,-2.47829721208783,2.09207486937083,1.18627242558818,3.13041463692480,-2.23155663915165,-2.23818557342093,0.783314818815263,1.66758290317218,2.07029138075884,0.0162731955682938,-0.589730492841806,1.63205273738210,4.91133127890285,2.21146043368942,0.211342392690382,-1.43628515314622,1.24937657685851,-1.21026120652963,0.596114089121321,1.94562047868734,2.31068232973974,1.47034478573393,3.44483569301151,4.62801233199244,-4.74416191861170,-4.44671044776954,-2.30660309151683,-4.99481770906891,-0.892750144306722,-0.841001899722055,0.626065011968119,0.715404752925454,-1.71542142028108,-2.03328621936124,1.98350639712969,-0.954863134878334,-3.42801042540745,0.0257686360638643,0.510330114369948,-1.02756376581135,1.65890294836078,0.564455348586089,-0.532107782828943,-0.110086427530839,1.14545455714181,-1.10354344702108,-2.63736680569336,-0.388960648764567,0.322869658129980,1.27357081899386,-0.0753088237358002,-1.14341237420010,1.49083906441617,-0.283821114221595,2.01756103860278,-0.224506848953444,-0.0157303130301178,-0.229651678604716,-2.30309570545780,-2.31737883308100,-2.40305168188035,4.46207459716709,-0.500472465540710,2.35102913571565,0.872890842888525,4.64820075171614,2.31767993290424,-3.06740960953928,-0.818097851235562,2.22911600177000,0.720463945326305,5.66298858393084,-0.119725826159414,-3.87966017133061,1.11020828007907,-2.27954719202383,0.123586618846799,2.69511468704842,0.770446899952816,0.749096356755275,-0.493046138854458,-0.366056082357112,-0.257677174447286,-6.99745486458106,0.983187940113401,2.47561788162969,-3.24408227668006,-3.80492090509350,1.55252826915969,-3.76880646280935,-4.19850534589491,1.97244050182597,-1.63570590133665,3.11225752579226,-3.23066104466245,-1.53588118405649,0.604238028387881,1.37337286997948,1.16908579390679,0.478642507522597,-0.574512389416574,-1.44804209980782,1.20120294291706,-0.967081604666825,1.05403885342344,2.71926463817188,-5.62332974611001,4.51120034892323,-1.58015094857976,3.29114551799151,3.87898014622665,-3.67227025876691,0.442345890217413,8.66564978597926,-0.536566811112579,1.21570640854931,0.827212799807445,3.16975520232460,2.72628551386152,-2.36612652583951,-1.09624785902674,0.858051680663816,-0.146008454866278,6.33743671933769,1.09661359440050,1.09379429499626,-2.09418998796765,-3.26875654006188,1.98535678855414,-0.493159473614018,1.62288204063621,-2.07868568039917,2.23988515000289,-4.53371605107064,3.91670863486992,2.11625166139674,0.275387090638850,-2.90275382104058,-0.993839256404825,0.635735777601231,3.01947359018565,-2.58385403174978,3.23786688571469,6.92030758335554,-1.23836787348091,1.17191381105466,-1.64324221789002,-4.29239310568581,3.67629776026600,1.73534316400090,-1.27674246668661,0.283468458302171,-0.574517869160038,-3.65433210004829,-7.20584034984915,-0.118669018823425,-1.15616487590473,-1.44161473687781,-2.11492089875698,-4.54308878525084,-1.30432653608862,0.403589695118336,-2.65452718716977,1.12623434805278,-0.681995183059514,-0.253635876837145,-3.57276486982167,-1.91102359672845,1.02534385827998,-1.97483187265123,0.404092823423322,4.94475999340873,1.98816606827440,2.59341683292339,5.90082491235860,2.93848774923135,0.994351065341390,4.87812179193622,-2.26164091051294,-1.70538047891637,5.04572894177474,1.13585794590298,-0.105260449547558,1.14541826060398,-0.660360340078766,-0.729962868379134,-0.966995358978381,-1.38498233248163,-2.35931982107395,-0.149620456622206,-1.43671192526535,3.60463824857921,0.588816824429266,2.55344137602681,-0.349576332356112,-0.203877757648120,3.14561687989589,3.67133500499005,0.0823521400980819,4.23119536323881,1.18932139597066,0.921325546044239,5.48000181058265,3.83921276215177,2.26815053830727,1.00564895588820,-1.34595500241769,-0.288038720764896,4.55500013825749,-5.05376664515065,-1.59244365180808,-0.472008060400270,0.370687604861689,-4.45970010991033,1.32266886987994,1.82432965368483,-2.35033730849779};
const phase_t LookUpTable[65]={0,0.0156237286204768,0.0312398334302683,0.0468407129159697,0.0624188099959574,0.0779666338315423,0.0934767811585895,0.108941956989866,0.124354994546761,0.139708874289164,0.154996741923941,0.170211925285474,0.185347949995695,0.200398553825879,0.215357699697738,0.230219587276844,0.244978663126864,0.259629629408258,0.274167451119659,0.288587361894077,0.302884868374971,0.317055753209147,0.331096076704132,0.345002177207105,0.358770670270572,0.372398446676754,0.385882669398074,0.399220769575253,0.412410441597387,0.425449637370042,0.438336559857958,0.451069655988524,0.463647609000806,0.476069330322761,0.488333951056406,0.500440813147294,0.512389460310738,0.524179628782913,0.535811237960464,0.547284380987437,0.558599315343562,0.569756453482978,0.580756353567670,0.591599710335111,0.602287346134964,0.612820202165241,0.623199329934066,0.633425882969145,0.643501108793284,0.653426341180762,0.663202992706093,0.672832547593763,0.682316554874748,0.691656621853200,0.700854407884450,0.709911618463525,0.718829999621625,0.727611332626511,0.736257428981428,0.744770125716075,0.753151280962194,0.761402769805578,0.769526480405658,0.777524310373348,0.785398163397448};
const phase_shift_t const_angle_shift_ech = CONST_ANGLE_SHIFT_ECH;
const phase_shift_t const_angle=CONST_ANGLE;
// constante pour le calcul de la difference entre deux mesures d'angles succesives.
const phase_t const_angle_c=6.5;
const stat_t threshold_std=0.00071;
const phase_t threshold_high = 3.0;
const phase_t threshold_low = -3.0;
//Max energy of a sample. The value was computed by statistical computation
const sin_cos_t max_energy = 0.0911828;
const latitude_rad_t conv_lat_m_deg=8.993216059187306e-06;
// pour une valeur de latitude égale à 32deg
const longitude_rad_t conv_lon_m_deg=1.351895023470476e-05;
//10^(snr/10); snr=1;2;3;4...30
const snr_t list_snr[30]={1.25892541179417,1.58489319246111,1.99526231496888,2.51188643150958,3.16227766016838,3.98107170553497,5.01187233627272,6.30957344480193,7.94328234724282,10,12.5892541179417,15.8489319246111,19.9526231496888,25.1188643150958,31.6227766016838,39.8107170553497,50.1187233627272,63.0957344480193,79.4328234724281,100,125.892541179417,158.489319246111,199.526231496888,251.188643150958,316.227766016838,398.107170553497,501.187233627272,630.957344480193,794.328234724281,1000};
//Conversion degré vers les radians
//phase_t deg_to_rad=0.0174532;
#define DEG_TO_RAD 0.0174532;
//Conversion radians vers degrés
#define RAD_TO_DEG 57.2958;

struct dynamic_information_init
{
	ap_uint<28> longitude_init;
	ap_uint<27> latitude_init;
	ap_uint<12> cog_init;
	ap_uint<10> sog_init;
};

struct dynamic_information
{
	ap_uint<28> longitude;
	ap_uint<27> latitude;
	ap_uint<12> cog;
	ap_uint<10> sog;
};

struct static_information
{
	ap_uint<6> message_id;
	ap_uint<2> repeat_indicator;
	ap_uint<30> user_id;
	ap_uint<4> navigational_status;
	ap_uint<8> rot;
	ap_uint<1> position_accuracy;
	ap_uint<9> true_heading;
	ap_uint<6> time_stamp;
	ap_uint<2> special_manoeuvre_indicator;
	ap_uint<3> spare;
	ap_uint<1> raim_flag;
	ap_uint<19> communication_state;
};

struct falsification_information
{
	int add_lat;
	int add_lon;
	ap_uint<12> add_cog;
	ap_uint<10> add_sog;
};

struct environmental_information
{
	snr_t snr;
	int f_shift;
	int delay;
};

struct out_information
{
	data_t data_obs_strm;
	longitude_rad_t longitude_strm_out;
	latitude_rad_t latitude_strm_out;
	ap_uint<NB_BITS_DATA> data_out_strm;
};

struct message_data
{
	data_t data;
	ap_uint<28> longitude;
	ap_uint<27> latitude;
	ap_uint<30> user_id;
	ap_uint<8> nb_bits=NB_BITS_DATA;
};

struct message_crc
{
	crc_t data;
	ap_uint<8> nb_bits=NB_BITS_CRC;
};

struct message_data_crc
{
	message_data data;
	message_crc crc;
};

struct message_hdlc
{
//	training_sequence_t training_sequence=0b010101010101010101010101 ;
	start_end_flag_t start_flag=0b01111110 ;
	message_data data;
	message_crc crc;
	start_end_flag_t end_flag ;
};

struct message_trame
{
	training_sequence_t training_sequence=0b010101010101010101010101 ;
	message_hdlc hdlc;
};

struct message_nrzi
{
	training_sequence_t training_sequence=0b011001100110011001100110 ;
	start_end_flag_t start_flag=0b01010100 ;
	message_data data;
	message_crc crc;
	start_end_flag_t end_flag=0 ;
};

struct data_crc
{
	ap_uint<168> data=0;
	ap_uint<16> crc=0;
};

struct data_separated
{
ap_uint<6> message_id=0;
ap_uint<2> repeat_indicator=0;
ap_uint<30> user_id=0;
ap_uint<4> navigational_status=0;
ap_uint<8> rot=0;
float sog=0;
ap_uint<1> position_accuracy=0;
float longitude=0;
float latitude=0;
float cog=0;
ap_uint<9> true_heading=0;
ap_uint<6> time_stamp=0;
ap_uint<2> special_manoeuvre_indicator=0;
ap_uint<3> spare=0;
ap_uint<1> raim_flag=0;
ap_uint<19> communication_stater=0;
};


//FPGA Simulator
void FPGA_simulator(hls::stream<snr_t> &snr_strm,hls::stream<int> &f_shift_strm,hls::stream<dynamic_information_init> &dynamic_information_init_strm,hls::stream<falsification_information> &falsification_information_strm,hls::stream<static_information> &static_information_strm,hls::stream<bool> &start_e,hls::stream<data_t> &data_obs_strm,hls::stream<sin_cos_t> &I_obs_strm_e,hls::stream<sin_cos_t> &Q_obs_strm_e,hls::stream<sin_cos_t> &I_obs_strm_c,hls::stream<sin_cos_t> &Q_obs_strm_c,hls::stream<longitude_rad_t> &longitude_strm_out,hls::stream<latitude_rad_t> &latitude_strm_out,hls::stream<ap_uint<NB_BITS_DATA>> &data_out_strm);

//PILOTING
void piloting(hls::stream<snr_t> &snr_strm,hls::stream<int> &f_shift_strm,hls::stream<dynamic_information_init> &dynamic_information_init_strm,hls::stream<falsification_information> &falsification_information_strm,hls::stream<static_information> &static_information_strm,hls::stream<data_t> &data_strm,hls::stream<bool> &start_e_in,hls::stream<bool> &start_e,hls::stream<data_t> &data_obs_strm,hls::stream<snr_t> &snr_out,hls::stream<int> &f_shift_out);
void dynamic_data_generation_e_p_c(hls::stream<dynamic_information_init> &dynamic_information_init_strm,hls::stream<falsification_information> &falsification_information_strm,hls::stream<dynamic_information> &dynamic_information_strm);
void NMEA_frame_building(int mes_l[NB_INFORMATION],hls::stream<data_t> &data_strm,hls::stream<data_t> &data_obs_strm);
void frame_building_e_p_c(hls::stream<static_information> &static_information_strm,hls::stream<dynamic_information> &dynamic_information_strm,hls::stream<data_t> &data,hls::stream<data_t> &data_obs);
void read_data_e_p_c(hls::stream<static_information> &static_information_strm,hls::stream<dynamic_information> &dynamic_information_strm,int mes_l[NB_INFORMATION]);
void piloting_simulator(hls::stream<snr_t> &snr_strm,hls::stream<int> &f_shift_strm,hls::stream<bool> &start_emission,hls::stream<bool> &start_e,hls::stream<snr_t> &snr_strm_out,hls::stream<int> &f_shift_strm_out);

//DIGITAL_TWIN
void CPS(hls::stream<bool> &start_emission,hls::stream<data_t> &data_strm,hls::stream<snr_t> &snr_strm,hls::stream<int> &f_shift_strm,hls::stream<sin_cos_t> &I_obs_strm_e,hls::stream<sin_cos_t> &Q_obs_strm_e,hls::stream<sin_cos_t> &I_obs_strm_c,hls::stream<sin_cos_t> &Q_obs_strm_c,hls::stream<longitude_rad_t> &longitude_strm_out,hls::stream<latitude_rad_t> &latitude_strm_out,hls::stream<ap_uint<NB_BITS_DATA>> &data_out_strm);

//EMITTER
void Read_data(hls::stream<data_t> &data_strm,ap_uint<27> *latitude_strm,ap_uint<28> *longitude_strm,message_data *mes_out);
//message_data check_correct_id(message_data  mes);
void Bytes_flipping(message_data trame,ap_uint<NB_BITS_DATA> *data_flipped_out);
crc_t F_CRC_CalculaCheckSum_e(ap_uint<168> AF_Datos, ap_uint<16> VF_nBytes);
void Compute_CRC(ap_uint<168> data,message_data_crc mes_data_crc);
void Bits_stuffing(ap_uint<NB_BITS_DATA> data,ap_uint<16> crc,message_data_crc *trame_out);
void HDLC_trame_construction(message_data_crc mes,message_hdlc *mes_hdlc_out);
void Trainning_sequence_adding(message_hdlc mes,message_trame *mes_trame_out);
void NRZI_coding(message_trame trame,message_nrzi *trame_hdlc_nrzi_out);
void GMSK_modulation(message_nrzi trame,phase_t in_phase[NB_EL_ARRAY]);
void modulation_gmsk_body(ap_uint<NB_BITS_TRAME> trame_bits,phase_t in_phase[NB_EL_ARRAY],ap_uint<8> nb_bits);
sin_cos_t cos_lookup (int n);
sin_cos_t sin_lookup (int n);
//void I_Q_coding(phase_t in_phase[NB_EL_ARRAY],sin_cos_t I[NB_EL_ARRAY],sin_cos_t Q[NB_EL_ARRAY]);
void I_Q_coding(phase_t in_phase[NB_EL_ARRAY],hls::stream<sin_cos_t> &I,hls::stream<sin_cos_t> &Q);
void amplifier(sin_cos_t I_in[NB_EL_ARRAY],sin_cos_t Q_in[NB_EL_ARRAY],sin_cos_t I_out[NB_EL_ARRAY],sin_cos_t Q_out[NB_EL_ARRAY],hls::stream<sin_cos_t> &I_out_obs,hls::stream<sin_cos_t> &Q_out_obs,bool flag_emission);
void emitter(hls::stream<bool> &start_emission,hls::stream<data_t> &data_strm,sin_cos_t I_strm[NB_EL_ARRAY],sin_cos_t Q_strm[NB_EL_ARRAY],hls::stream<sin_cos_t> &I_obs_strm,hls::stream<sin_cos_t> &Q_obs_strm,ap_uint<27> *latitude_strm,ap_uint<28> *longitude_strm);

// CANAL
void Delay_adding(sin_cos_t I_in[NB_EL_ARRAY],sin_cos_t Q_in[NB_EL_ARRAY],sin_cos_t I_out[NB_EL_ARRAY],sin_cos_t Q_out[NB_EL_ARRAY]);
void Noise_adding(sin_cos_t I_in[NB_EL_ARRAY],sin_cos_t Q_in[NB_EL_ARRAY],sin_cos_t I_out[NB_EL_ARRAY],sin_cos_t Q_out[NB_EL_ARRAY],hls::stream<sin_cos_t> &I_out_obs,hls::stream<sin_cos_t> &Q_out_obs,hls::stream<snr_t> &snr_strm,hls::stream<sin_cos_t> &fading_ampl_strm);
int32_t isqrt(int32_t num);
int compute_distance(hls::stream<ap_uint<27>> & latitude_strm,hls::stream<ap_uint<28>> & longitude_strm);
void Fading(sin_cos_t I_in[NB_EL_ARRAY],sin_cos_t Q_in[NB_EL_ARRAY],ap_uint<27> latitude_strm,ap_uint<28> longitude_strm,sin_cos_t I_out[NB_EL_ARRAY],sin_cos_t Q_out[NB_EL_ARRAY],hls::stream<sin_cos_t> &fading_ampl);
void channel(sin_cos_t I_in[NB_EL_ARRAY],sin_cos_t Q_in[NB_EL_ARRAY],sin_cos_t I_out[NB_EL_ARRAY],sin_cos_t Q_out[NB_EL_ARRAY],hls::stream<sin_cos_t> &I_out_obs,hls::stream<sin_cos_t> &Q_out_obs,ap_uint<27> latitude_strm,ap_uint<28> longitude_strm,hls::stream<snr_t> &snr_tmp,hls::stream<int> &f_shift);
void Shift_frequency(sin_cos_t I_in[NB_EL_ARRAY],sin_cos_t Q_in[NB_EL_ARRAY],sin_cos_t I_in1[NB_EL_ARRAY],sin_cos_t Q_in1[NB_EL_ARRAY],hls::stream<int> &idx_f_shift);
void sum(sin_cos_t I_in_1[NB_EL_ARRAY],sin_cos_t Q_in_1[NB_EL_ARRAY],sin_cos_t I_in_2[NB_EL_ARRAY],sin_cos_t Q_in_2[NB_EL_ARRAY],sin_cos_t I_out[NB_EL_ARRAY],sin_cos_t Q_out[NB_EL_ARRAY]);

//RECEIVER
void change_dynamic(sin_cos_t I_in[NB_EL_ARRAY],sin_cos_t Q_in[NB_EL_ARRAY],sin_cos_t I_out[NB_EL_ARRAY],sin_cos_t Q_out[NB_EL_ARRAY],bool *flag);
void DAC(sin_cos_t I_in[NB_EL_ARRAY],sin_cos_t Q_in[NB_EL_ARRAY],sin_cos_t I_out[NB_EL_ARRAY],sin_cos_t Q_out[NB_EL_ARRAY]);
//void compute_std(dac_t I_in[NB_EL_ARRAY],dac_t Q_in[NB_EL_ARRAY],stat_t *std);
//bool detect_message(stat_t std);
void filtered_list_p(phase_t list_in[NB_EL_ARRAY],phase_t list_out[NB_EL_ARRAY]);
void filtered_list(sin_cos_t list_in[NB_EL_ARRAY],sin_cos_t list_out[NB_EL_ARRAY]);
phase_t atan2_maelic(sin_cos_t sin16s,sin_cos_t cos16s);
void angle_computation(sin_cos_t I[NB_EL_ARRAY],sin_cos_t Q[NB_EL_ARRAY],phase_t tmp_diff_phase_array_0[NB_EL_ARRAY]);
void correlation_computation(phase_t tmp_diff_phase_array_0[NB_EL_ARRAY],ap_uint<13> *idx_max);
void bits_decoding(ap_uint<13> idx_max,phase_t tmp_diff_phase_array[NB_EL_ARRAY],ap_uint<NB_BITS_TRAME_MAX> *bits_decoded);
void GMSK_demodulation(sin_cos_t I_in[NB_EL_ARRAY],sin_cos_t Q_in[NB_EL_ARRAY],ap_uint<NB_BITS_TRAME_MAX> *bits_decoded);
void NRZI_decoding(ap_uint<NB_BITS_TRAME_MAX> bits,ap_uint<NB_BITS_TRAME_MAX> *bits_decoded);
void find_start(ap_uint<NB_BITS_TRAME_MAX> bit_decode,ap_uint<9> *idx);
void Bits_unstuffing(ap_uint<NB_BITS_TRAME_MAX> bit_decode,ap_uint<NB_BITS_DATA_CRC> *bit_decoded_unstuffed_1,ap_uint<NB_BITS_DATA_CRC> *bit_decoded_unstuffed_2);
bool IsCrc16Good(ap_uint<8> pData[23]);
void CRC_check(ap_uint<NB_BITS_DATA_CRC> bit_decoded_unstuffed,bool *check);
void Bytes_flipping_r(ap_uint<NB_BITS_DATA_CRC> bits_decoded_unstuffed,ap_uint<NB_BITS_DATA> *bit_decode_flipped);
void Information_extraction(ap_uint<NB_BITS_DATA> bit_decoded_unstuffed,bool check,hls::stream<longitude_rad_t> &longitude_strm,hls::stream<latitude_rad_t> &latitude_strm,hls::stream<ap_uint<NB_BITS_DATA>> &data_out_strm,ap_uint<30> *user_id,bool flag);
void receiver(sin_cos_t I_strm[NB_EL_ARRAY],sin_cos_t Q_strm[NB_EL_ARRAY],hls::stream<longitude_rad_t> &longitude_strm,hls::stream<latitude_rad_t> &latitude_strm,hls::stream<ap_uint<NB_BITS_DATA>> &data_out_strm);

#endif


